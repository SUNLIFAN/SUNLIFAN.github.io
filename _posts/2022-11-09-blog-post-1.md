---
title: 'Compilers : Lexer - generated by Antlr v4'
date: 2022-11-09
permalink: /posts/2022/11/cp02
tags:
  - computer science
  - programming language
  - compilers
---

## Outline

1. Lexer overview

2. Ways to design a lexer

3. Specification of tokens

4. Regular Expression

## Detail

### Lexer Overview

词法分析器接受程序文本/字符串（也就是一个字符流） + 一个词法单元规约，输出一个词法单元流，语法分析器可以通过调用词法分析器的接口来获得下一个 token.

![](https://github.com/SUNLIFAN/images/blob/main/post/cp021.png?raw=true)

### Ways to design a lexer

主要有三种设计词法分析器的方法:

- 使用词法分析器生成器，用户只需要输入词法单元的规约，就可以生成一个词法分析器，即一个可以进行词法分析的程序

- 手写一个词法分析器，由于词法分析器复杂度不大，手写的灵活性较高，因此生产环境一般用手写，比如 gcc

- 自动化词法分析器，就是手写一个词法分析器生成器

### Specification of tokens

为了使用词法分析器生成器，我们需要定义我们的语言的词法单元的形式化规约，描述哪个 token 应该具有怎样的模式，以及整个程序如何由最简单的 token 组合而成。

**Definition: Alphabet**

字母表 $\Sigma$ 是一个有穷的符号的集合，至于里面的符号具体长什么样，我们是不关心的。

**Definition: String**

字母表 $\Sigma$ 上的串是由 $\Sigma$ 上的符号所构成的有穷序列。

$\epsilon$ 表示空串，$\mid\epsilon\mid$ = 0

**Definition: String operation - concat**

串上的连接运算，假设 x 和 y 是两个串，那么他们的 x concat y = xy

空串是连接运算的零元，即 $x\epsilon = \epsilon x = x$

**Definition: String operation - exponent**

$s^0 = \epsilon$

$s^i = s s^{i-1}, i > 0$

**Definition: Language**

语言 (Language) 是给定字母表 $\Sigma$ 上一个任意的可数的串的集合。

语言是串的集合，因此可以用集合的操作来构建新的语言。

**Set Operation**

![](https://github.com/SUNLIFAN/images/blob/main/post/cp022.png?raw=true)

### Regular Expression

有了上面的形式化规约，那么该如何向词法分析器生成器，比如 antlr，传递这个规约? 一个简单的方法是使用正则表达式。
每个语言都有语法和语义两个部分，正则表达式表达了一个匹配的模式，每个正则表达式 $r$ (一个 pattern) 都有一个对应的语言  $L(r)$ (一个符合 pattern 的实例集合)，正则表达式是语法，正则语言是语义。

**Definition: regex**

给定一个字母表 $\Sigma$, $\Sigma$ 上的正则表达式由且仅由以下规则定义:

- $\epsilon$ 是正则表达式

- $\forall a\in \Sigma$, a 是正则表达式

- 如果 r 是正则表达式，那么 (r) 是正则表达式

- 如果 r 和 s 是正则表达式，那么 $r \mid s, rs, r^*$ 是正则表达式，且运算优先级由高到低依次是 (), *, concat, $\mid$

**Definition: regular language**

每个正则表达式对应一个正则语言:

$L(\epsilon) = \{\epsilon\}$

$L(a) = \{a, \forall a \in \Sigma\}$

$L((r)) = L(r)$

$L(r\mid s) = L(r) \cup L(s), L(rs) = L(r)L(s), L(r^*) = L(r)^*$

### Summary

使用词法分析器生成器来设计一个词法分析器需要提供一个词法单元规约，可以使用正则表达式来描述。