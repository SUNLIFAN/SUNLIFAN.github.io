---
title: '《MySQL 是怎样运行的》阅读随笔01: MySQL 基础架构'
date: 2023-03-11
permalink: /posts/2023/03/mysql-01
tags:
  - software engineering
  - MySQL
  - database
---
## MySQL 的 C/S 架构

MySQL 采用的是 C/S 架构，有客户端和服务端，客户端发出查询请求，服务端处理完之后返回结果。

在 Windows 上，安装完 MySQL 之后，可以通过 `service mysql start` 来启动 MySQL 服务端。

可以在 cmd 中通过 `mysql -h [主机名] -u [用户名] -p` 之后再输入密码来登录 MySQL 客户端。

MySQL 使用 TCP 来进行网络通信，默认使用 3306 端口，配合给出的主机名就可以和服务器进程进行通信。

除此之外，客户端还可以使用命名管道，共享内存，UNIX 域套接字来和服务端进行通讯。

## 连接管理

每当有一个客户端连接到服务端，服务端就会为客户端分配一个线程来处理相关的交互，在这次交互结束之后，这个线程也不会被销毁，而是用类似线程池的机制管理起来，下一次客户端连接来了还可以复用，以减少创建和销毁线程的开销。但是如果来的客户端请求太多，会创建很多线程，线程太多了也会影响系统性能，因此有一个最大连接数限制，可以通过配置指定。

## 查询缓存

在早期的 MySQL 中会把查询语句和结果缓存，如果发现来的查询语句和缓存中的逐字符相同，且查询语句中不包含一些函数，比如 NOW，而且查询相关的表没有被修改过，那么会直接返回缓存的内容。然而维护这样一个缓存也是有代价的，而且对性能的提升也不明显，因此在 MySQL 8.0 之后将被废弃。

## 语法分析

语法分析就是把查询语句 (字符流) 转换为语法树或者其他一些 DBMS 内部使用的数据结构的过程，会对查询语句做语法检查(是否符合语法)，语义检查 （表是否存在，列是否存在）以及记录一些信息。

## 查询优化

MySQL 的优化程序会对我们的语句做一些优化，如外连接转换为内连接、表达式简化、子查询转为连接吧啦吧啦的一堆东西。优化的结果就是生成一个执行计划，这个执行计划表明了应该使用哪些索引进行查询，表之间的连接顺序是啥样的。我们可以使用 EXPLAIN 语句来查看某个语句的执行计划。

## 存储引擎

为了方便，人们也常常把连接管理、语法分析、查询优化这些和存取数据无关的组件合称为 MySQL server，涉及数据存取的功能的组件叫做存储引擎。在得到查询优化器生成的查询计划之后只需要按照查询计划执行数据存取，然后把结果返回给客户端，一次查询处理就完成了。InnoDB 和 MyISAM 是 MySQL 的存储引擎中用的比较多的，其中 InnoDB 是默认的存储引擎。

## 一条 SQL 语句是怎样被处理的

客户端键入 SQL 语句 -> 连接到服务端并把查询语句发送到服务端 -> 语法分析 -> 查询优化 -> 查询执行 -> 结果返回 -> 客户端连接断开。